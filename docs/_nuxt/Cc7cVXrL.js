import{a as de,J as U,r as _,K as Se,L as Ce,H as De,M as me,N as Le,E as X,O as ie,P as ke,Q as Ne,R as w,d as B,S as q,T as K,j as A,t as L,v as E,U as fe,x as i,V as ve,_ as I,o as pe,W as Ee,e as _e,z as V,A as R,X as H,Y as O,B as T,Z as Q,$ as Y,y as N,a0 as J,a1 as Pe,a2 as Me,a3 as Ve,u as $e,a4 as Te}from"./C5NEhRBw.js";const Oe=a=>a==="defer"||a===!1;function Re(...a){var y;const o=typeof a[a.length-1]=="string"?a.pop():void 0;typeof a[0]!="string"&&a.unshift(o);let[s,u,e={}]=a;if(typeof s!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof u!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");const n=de(),m=u,c=()=>U.value,f=()=>n.isHydrating?n.payload.data[s]:n.static.data[s];e.server=e.server??!0,e.default=e.default??c,e.getCachedData=e.getCachedData??f,e.lazy=e.lazy??!1,e.immediate=e.immediate??!0,e.deep=e.deep??U.deep,e.dedupe=e.dedupe??"cancel";const b=e.getCachedData(s,n),p=b!=null;if(!n._asyncData[s]||!e.immediate){(y=n.payload._errors)[s]??(y[s]=U.errorValue);const x=e.deep?_:Se;n._asyncData[s]={data:x(p?b:e.default()),pending:_(!p),error:Ce(n.payload._errors,s),status:_("idle"),_default:e.default}}const t={...n._asyncData[s]};delete t._default,t.refresh=t.execute=(x={})=>{if(n._asyncDataPromises[s]){if(Oe(x.dedupe??e.dedupe))return n._asyncDataPromises[s];n._asyncDataPromises[s].cancelled=!0}if(x._initial||n.isHydrating&&x._initial!==!1){const h=x._initial?b:e.getCachedData(s,n);if(h!=null)return Promise.resolve(h)}t.pending.value=!0,t.status.value="pending";const v=new Promise((h,S)=>{try{h(m(n))}catch($){S($)}}).then(async h=>{if(v.cancelled)return n._asyncDataPromises[s];let S=h;e.transform&&(S=await e.transform(h)),e.pick&&(S=Xe(S,e.pick)),n.payload.data[s]=S,t.data.value=S,t.error.value=U.errorValue,t.status.value="success"}).catch(h=>{if(v.cancelled)return n._asyncDataPromises[s];t.error.value=Ne(h),t.data.value=w(e.default()),t.status.value="error"}).finally(()=>{v.cancelled||(t.pending.value=!1,delete n._asyncDataPromises[s])});return n._asyncDataPromises[s]=v,n._asyncDataPromises[s]},t.clear=()=>Be(n,s);const d=()=>t.refresh({_initial:!0}),D=e.server!==!1&&n.payload.serverRendered;{const x=De();if(x&&D&&e.immediate&&!x.sp&&(x.sp=[]),x&&!x._nuxtOnBeforeMountCbs){x._nuxtOnBeforeMountCbs=[];const S=x._nuxtOnBeforeMountCbs;me(()=>{S.forEach($=>{$()}),S.splice(0,S.length)}),Le(()=>S.splice(0,S.length))}D&&n.isHydrating&&(t.error.value||b!=null)?(t.pending.value=!1,t.status.value=t.error.value?"error":"success"):x&&(n.payload.serverRendered&&n.isHydrating||e.lazy)&&e.immediate?x._nuxtOnBeforeMountCbs.push(d):e.immediate&&d();const v=ke();if(e.watch){const S=X(e.watch,()=>t.refresh());v&&ie(S)}const h=n.hook("app:data:refresh",async S=>{(!S||S.includes(s))&&await t.refresh()});v&&ie(h)}const l=Promise.resolve(n._asyncDataPromises[s]).then(()=>t);return Object.assign(l,t),l}function Be(a,o){o in a.payload.data&&(a.payload.data[o]=void 0),o in a.payload._errors&&(a.payload._errors[o]=U.errorValue),a._asyncData[o]&&(a._asyncData[o].data.value=void 0,a._asyncData[o].error.value=U.errorValue,a._asyncData[o].pending.value=!1,a._asyncData[o].status.value="idle"),o in a._asyncDataPromises&&(a._asyncDataPromises[o]&&(a._asyncDataPromises[o].cancelled=!0),a._asyncDataPromises[o]=void 0)}function Xe(a,o){const s={};for(const u of o)s[u]=a[u];return s}var C=(a=>(a.ASC="asc",a.DESC="desc",a.NONE="none",a))(C||{});const Ae={class:"sort-switch__text"},Ie=B({__name:"SortSwitch",props:q({disabled:{type:Boolean,default:!1}},{modelValue:{type:String,default:C.NONE},modelModifiers:{}}),emits:q(["change"],["update:modelValue"]),setup(a,{emit:o}){const s=K(a,"modelValue"),u=o,e=a,n=A(()=>{const c=[];return e.disabled&&c.push("disabled"),s.value===C.ASC&&c.push("asc"),s.value===C.DESC&&c.push("desc"),c}),m=c=>{if(e.disabled){c.preventDefault(),c.stopPropagation();return}s.value===C.NONE?s.value=C.ASC:s.value===C.ASC?s.value=C.DESC:s.value=C.NONE,u("change",s.value)};return(c,f)=>(E(),L("div",{class:fe(["sort-switch",w(n)]),onClick:m,onTouchend:m},[i("div",Ae,[ve(c.$slots,"default",{},void 0)]),f[0]||(f[0]=i("span",{class:"sort-switch__arrows"},[i("span",{class:"sort-switch__arrows-top-arrowhead"}),i("span",{class:"sort-switch__arrows-bottom-arrowhead"})],-1))],34))}}),Ue=I(Ie,[["__scopeId","data-v-b8166080"]]),ze=Symbol.for("nuxt:client-only"),je=B({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(a,{slots:o,attrs:s}){const u=_(!1);return pe(()=>{u.value=!0}),Ee(ze,!0),e=>{var f;if(u.value)return(f=o.default)==null?void 0:f.call(o);const n=o.fallback||o.placeholder;if(n)return n();const m=e.fallback||e.placeholder||"",c=e.fallbackTag||e.placeholderTag||"span";return L(c,s,m)}}});var M=(a=>(a.XS="xs",a.SM="sm",a.MD="md",a.SLG="slg",a.LG="lg",a.XL="xl",a.XXL="xxl",a))(M||{});class Z{constructor(o,s=C.NONE){this.sortBy=o,this.sortDirection=s}}function ee(){const a=_({height:0,width:0}),o=_({x:0,y:0}),s={[M.XS]:0,[M.SM]:480,[M.MD]:720,[M.SLG]:960,[M.LG]:1200,[M.XL]:1440,[M.XXL]:1920};me(()=>{n(),window.addEventListener("resize",e),window.addEventListener("scroll",u)}),_e(()=>{window.removeEventListener("resize",e),window.removeEventListener("scroll",u)});const u=()=>{o.value={x:window.scrollX,y:window.scrollY}},e=()=>{n()},n=()=>{a.value.height=window.innerHeight,a.value.width=window.innerWidth},m=(f,b)=>{const p=Object.values(M),t=p.findIndex(l=>f===l),d=b?p.findIndex(l=>b===l):p.length;return p.slice(t,d+1).includes(c.value)},c=A(()=>{const f=Object.values(M);for(let b=f.length-1;b>=0;b--){const p=f[b];if(s[p]<=a.value.width)return p}return f[f.length-1]});return{currentResolution:c,windowSize:a,scrollPos:o,includeResolutions:m,resolutionsValues:s}}const Fe={class:"apartments-list"},qe={key:0,class:"apartments-list__blocks"},He={class:"apartments-list__blocks-sorting"},We={class:"apartments-list__blocks-item"},Ge={class:"apartments-list__blocks-item__data"},Ke={class:"apartments-list__blocks-item__data-name"},Qe={class:"apartments-list__blocks-item__data-other"},Ye={class:"opacity-50"},Je={key:1,class:"apartments-list__table"},Ze={class:"apartments-list__table-head-row"},et={class:"apartments-list__table-data-row"},tt={class:"opacity-50"},at=B({__name:"ListBlock",props:{apartments:{type:Array,default:[]}},emits:["sort-change"],setup(a,{emit:o}){const s=o,u=_(C.NONE),e=_(C.NONE),n=_(C.NONE),{includeResolutions:m}=ee(),c=(p,t)=>{switch(u.value=C.NONE,e.value=C.NONE,n.value=C.NONE,p){case"area":u.value=t;break;case"level":e.value=t;break;case"price":n.value=t;break}s("sort-change",new Z(p,t))},f=p=>`/kelnik_testtask_vue${p.structure_image}`,b=p=>({"--image":`url("${f(p)}")`});return(p,t)=>{const d=Ue,D=je;return E(),L("div",Fe,[V(D,null,{default:R(()=>[w(m)(w(M).XS,w(M).LG)?(E(),L("div",qe,[i("div",He,[V(d,{modelValue:w(u),"onUpdate:modelValue":[t[0]||(t[0]=l=>O(u)?u.value=l:null),t[1]||(t[1]=l=>c("area",l))]},{default:R(()=>t[12]||(t[12]=[T("S, м²")])),_:1},8,["modelValue"]),V(d,{modelValue:w(e),"onUpdate:modelValue":[t[2]||(t[2]=l=>O(e)?e.value=l:null),t[3]||(t[3]=l=>c("level",l))]},{default:R(()=>t[13]||(t[13]=[T("Этаж")])),_:1},8,["modelValue"]),V(d,{modelValue:w(n),"onUpdate:modelValue":[t[4]||(t[4]=l=>O(n)?n.value=l:null),t[5]||(t[5]=l=>c("price",l))]},{default:R(()=>t[14]||(t[14]=[T("Цена, ₽")])),_:1},8,["modelValue"])]),(E(!0),L(Q,null,Y(a.apartments,l=>(E(),L("div",We,[i("div",Ge,[i("div",Ke,N(l.name),1),i("div",Qe,[i("span",null,N(l.area)+" м²",1),i("span",null,[T(N(l.level)+" ",1),i("span",Ye," из "+N(l.level_total)+" этаж ",1)]),i("span",null,N(l.price)+" ₽",1)])]),i("div",{class:"apartments-list__blocks-item__image",style:J(b(l))},null,4)]))),256))])):H("",!0),w(m)(w(M).XL)?(E(),L("table",Je,[i("thead",null,[i("tr",Ze,[t[18]||(t[18]=i("th",null,"Планировка",-1)),t[19]||(t[19]=i("th",null,"Квартира",-1)),t[20]||(t[20]=i("th",null,"Комнат",-1)),i("th",null,[V(d,{modelValue:w(u),"onUpdate:modelValue":[t[6]||(t[6]=l=>O(u)?u.value=l:null),t[7]||(t[7]=l=>c("area",l))]},{default:R(()=>t[15]||(t[15]=[T("S, м²")])),_:1},8,["modelValue"])]),i("th",null,[V(d,{modelValue:w(e),"onUpdate:modelValue":[t[8]||(t[8]=l=>O(e)?e.value=l:null),t[9]||(t[9]=l=>c("level",l))]},{default:R(()=>t[16]||(t[16]=[T("Этаж")])),_:1},8,["modelValue"])]),i("th",null,[V(d,{modelValue:w(n),"onUpdate:modelValue":[t[10]||(t[10]=l=>O(n)?n.value=l:null),t[11]||(t[11]=l=>c("price",l))]},{default:R(()=>t[17]||(t[17]=[T("Цена, ₽")])),_:1},8,["modelValue"])])])]),i("tbody",null,[(E(!0),L(Q,null,Y(a.apartments,l=>(E(),L("tr",et,[i("td",{class:"apartments-list__table-data-row__image",style:J(b(l))},null,4),i("td",null,N(l.name),1),i("td",null,N(l.rooms),1),i("td",null,N(l.area),1),i("td",null,[T(N(l.level)+" ",1),i("span",tt,"из "+N(l.level_total),1)]),i("td",null,N(l.price),1)]))),256))])])):H("",!0)]),_:1})])}}}),st=I(at,[["__scopeId","data-v-31fe9848"]]),nt={class:"circle-button__text"},lt=B({__name:"CircleButton",props:{active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},setup(a){const o=a,s=A(()=>{const e=[];return o.active&&e.push("active"),o.disabled&&e.push("disabled"),e}),u=e=>{o.disabled&&(e.preventDefault(),e.stopPropagation())};return(e,n)=>(E(),L("div",{class:fe(["circle-button",w(s)]),onClick:u,onTouchend:u},[i("div",nt,[ve(e.$slots,"default",{},void 0)])],34))}}),ot=I(lt,[["__scopeId","data-v-4ef955f8"]]),rt={class:"number-slider__label"},it={class:"number-slider__numbers"},ut={class:"number-slider__numbers-number"},ct={class:"number-slider__numbers-number"},dt={class:"number-slider__slider"},ue=0,mt=B({__name:"NumberSlider",props:q({label:{type:String,required:!0},min:{type:Number,required:!0},max:{type:Number,required:!0}},{left:{type:Number},leftModifiers:{},right:{type:Number},rightModifiers:{}}),emits:q(["change"],["update:left","update:right"]),setup(a,{emit:o}){const s=o,u=K(a,"left"),e=K(a,"right"),n=Pe("sliderRefName"),m=_(!1),c=_(0),f=_(0),b=_(0),p=_(0),t=_(!1),d=_(0),D=_(0),l=_(0),y=_(0),x=_(void 0),v=a,{windowSize:h}=ee();X(h.value,()=>{S(),W()}),X(()=>v.min,()=>{u.value=v.min}),X(()=>v.max,()=>{e.value=v.max}),X(u,(r,g)=>{r&&W()}),X(e,(r,g)=>{r&&W()}),pe(()=>{S(),u.value=v.min,e.value=v.max,d.value=$.value,G(c.value,d.value),window.addEventListener("touchend",j),window.addEventListener("mouseup",j),window.addEventListener("touchmove",z),window.addEventListener("mousemove",z)}),_e(()=>{window.removeEventListener("touchend",j),window.removeEventListener("mouseup",j),window.removeEventListener("touchmove",z),window.removeEventListener("mousemove",z)});const S=()=>{var r;x.value=(r=n==null?void 0:n.value)==null?void 0:r.getBoundingClientRect()},$=A(()=>{var r;return((r=x.value)==null?void 0:r.width)||0}),he=A(()=>({"--left-shift":`${c.value}px`,"--right-shift":`${d.value}px`,"--active-background-width":`${d.value-c.value}px`})),W=()=>{const r=v.max-v.min;if(u.value){const k=(u.value-v.min)/r,P=Math.round(k*$.value);c.value=P}if(e.value){const k=(e.value-v.min)/r,P=Math.round(k*$.value);d.value=P}},G=(r,g)=>{const k=v.max-v.min,P=r/$.value,ye=g/$.value,we=v.min+k*P,xe=v.min+k*ye,oe=Math.round(we),re=Math.round(xe);(u.value!==oe||e.value!==re)&&(u.value=oe,e.value=re,s("change",{left:u.value,right:e.value}))},j=r=>{r?z(r):(m.value&&(p.value=c.value,se()),t.value&&(y.value=d.value,le())),m.value=!1,t.value=!1},z=r=>{var k,P;r.stopPropagation(),r.preventDefault();let g;r instanceof MouseEvent?g=r.x:r instanceof TouchEvent&&(g=(P=(k=r==null?void 0:r.touches)==null?void 0:k[0])==null?void 0:P.clientX),g!==void 0&&(m.value&&(b.value=g,se()),t.value&&(l.value=g,le()))},ae=r=>{var k,P;r.stopPropagation(),r.preventDefault();let g=0;r instanceof MouseEvent?g=r.x:r instanceof TouchEvent&&(g=(P=(k=r==null?void 0:r.touches)==null?void 0:k[0])==null?void 0:P.clientX),p.value=c.value,f.value=g,m.value=!0},se=()=>{ge(p.value+b.value-f.value)},ge=r=>{r<ue?u.value=v.min:r>d.value?u.value=e.value:r>$.value?u.value=v.max:G(r,d.value)},ne=r=>{var k,P;r.stopPropagation(),r.preventDefault();let g=0;r instanceof MouseEvent?g=r.x:r instanceof TouchEvent&&(g=(P=(k=r==null?void 0:r.touches)==null?void 0:k[0])==null?void 0:P.clientX),y.value=d.value,D.value=g,t.value=!0},le=()=>{be(y.value+l.value-D.value)},be=r=>{r<ue?e.value=v.min:r<c.value?e.value=u.value:r>$.value?e.value=v.max:G(c.value,r)};return(r,g)=>(E(),L("div",{class:"number-slider",ref:"sliderRefName",style:J(w(he))},[i("div",rt,N(a.label),1),i("div",it,[i("div",null,[g[0]||(g[0]=i("span",{class:"number-slider__numbers-label"},"от",-1)),i("span",ut,N(u.value),1)]),i("div",null,[g[1]||(g[1]=i("span",{class:"number-slider__numbers-label"},"до",-1)),i("span",ct,N(e.value),1)])]),i("div",dt,[g[2]||(g[2]=i("div",{class:"number-slider__slider-inactive-background"},null,-1)),g[3]||(g[3]=i("div",{class:"number-slider__slider-active-background"},null,-1)),i("div",{class:"number-slider__slider-left-button",onTouchstart:ae,onMousedown:ae},null,32),i("div",{class:"number-slider__slider-right-button",onTouchstart:ne,onMousedown:ne},null,32)])],4))}}),ft=I(mt,[["__scopeId","data-v-bab9d3f5"]]);class F{constructor(o=0,s=5){this.from=o,this.limit=s}}class te{constructor(o,s,u,e,n=[]){this.minPrice=o,this.maxPrice=s,this.minArea=u,this.maxArea=e,this.roomsCounts=n}}const vt=Me("apartments",{state:()=>({apartments:[],total:0}),getters:{getApartments:a=>a.apartments,getTotal:a=>a.total},actions:{async loadApartments(a=new F,o=new Z,s=new te){var p;const{$api:u}=de(),n=await u("/apartments.json",{});if(!n)return!1;let m=[];for(let t=0;t<n.length;t++){const d=n[t];s.minPrice!==void 0&&d.price<s.minPrice||s.maxPrice!==void 0&&d.price>s.maxPrice||s.minArea!==void 0&&d.area<s.minArea||s.maxArea!==void 0&&d.area>s.maxArea||(p=s.roomsCounts)!=null&&p.length&&!s.roomsCounts.includes(d.rooms)||m.push(d)}const c=m.length;if(o.sortBy&&o.sortDirection!==C.NONE){const{sortBy:t,sortDirection:d}=o;m.sort((D,l)=>D[t]<l[t]?d===C.ASC?-1:1:D[t]>l[t]?d===C.ASC?1:-1:0)}const f=a.from||0,b=a.limit||5;return m=m.slice(f,f+b),this.apartments=m,this.total=c,!0}}}),pt={class:"apartments-filters"},_t={class:"apartments-filters__rooms"},ht=4,gt=B({__name:"FiltersBlock",props:{price:{type:Object,required:!0},area:{type:Object,required:!0}},emits:["change"],setup(a,{emit:o}){const s=a,u=o,e=_(0),n=_(0),m=_(0),c=_(0),f=_(new Set),b=l=>{f.value.has(l)?f.value.delete(l):f.value.add(l),d()},p=()=>{d()},t=()=>{d()},d=()=>{u("change",new te(e.value,n.value,m.value,c.value,[...f.value]))},D=()=>{e.value=s.price.min,n.value=s.price.max,m.value=s.area.min,c.value=s.area.max,f.value=new Set};return(l,y)=>{const x=ot,v=ft;return E(),L("div",pt,[i("div",_t,[(E(),L(Q,null,Y(ht,h=>V(x,{active:w(f).has(h),onClick:()=>b(h),onTouchend:()=>b(h)},{default:R(()=>[T(N(h)+"к",1)]),_:2},1032,["active","onClick","onTouchend"])),64))]),V(v,{left:w(e),"onUpdate:left":y[0]||(y[0]=h=>O(e)?e.value=h:null),right:w(n),"onUpdate:right":y[1]||(y[1]=h=>O(n)?n.value=h:null),label:"Стоимость квартиры, ₽",min:a.price.min,max:a.price.max,onChange:p},null,8,["left","right","min","max"]),y[5]||(y[5]=i("div",null,null,-1)),V(v,{left:w(m),"onUpdate:left":y[2]||(y[2]=h=>O(m)?m.value=h:null),right:w(c),"onUpdate:right":y[3]||(y[3]=h=>O(c)?c.value=h:null),label:"Площадь, м²",min:a.area.min,max:a.area.max,onChange:t},null,8,["left","right","min","max"]),y[6]||(y[6]=i("div",null,null,-1)),i("div",{class:"apartments-filters__clear",onClick:D,onTouchend:D},y[4]||(y[4]=[T(" Сбросить параметры "),i("span",{class:"apartments-filters__clear-icon x-icon"},null,-1)]),32)])}}}),bt=I(gt,[["__scopeId","data-v-220d6c57"]]),yt=B({__name:"ScrollTop",setup(a){const{scrollPos:o}=ee(),s=()=>{scroll({top:0,behavior:"smooth"})};return(u,e)=>w(o).y>0?(E(),L("div",{key:0,class:"scroll-top",onClick:s,onTouchend:s},e[0]||(e[0]=[i("div",{class:"scroll-top__arrow-head"},null,-1),i("div",{class:"scroll-top__arrow-shaft"},null,-1)]),32)):H("",!0)}}),wt=I(yt,[["__scopeId","data-v-0921841e"]]);function ce(a,o){let s;return(...u)=>{clearTimeout(s),s=setTimeout(()=>{a(...u)},o)}}const xt={class:"apartments-page"},St={class:"apartments-page__content"},Ct={class:"apartments-page__content-main"},Dt=5,Lt=5,kt=B({__name:"index",async setup(a){let o,s;const u=Ve();$e();const e=vt(),n=_(new F),m=_(new te),c=_(new Z),f=_(!0);X(u,()=>{b()}),[o,s]=Te(()=>Re(()=>e.loadApartments(),"$pqtWcjQkdb")),await o,s();const b=async()=>{f.value=!0,await e.loadApartments(n.value,c.value,m.value),f.value=!1},p=ce(y=>{m.value=y,n.value=new F(0,Dt),b()},50),t=ce(y=>{c.value=y,b()},20),d=()=>{n.value=new F(0,n.value.limit+Lt),b()},D=A(()=>e.getApartments),l=A(()=>e.getTotal);return(y,x)=>{const v=st,h=bt,S=wt;return E(),L("div",xt,[i("div",St,[i("div",Ct,[x[0]||(x[0]=i("h1",{class:"apartments-page__content-main__label"},"Квартиры",-1)),V(v,{apartments:w(D),onSortChange:w(t)},null,8,["apartments","onSortChange"]),w(D).length<w(l)?(E(),L("div",{key:0,class:"apartments-page__content-load-more",onClick:d,onTouchend:d}," Загрузить еще ",32)):H("",!0)]),V(h,{class:"apartments-page__content-filters",area:{min:15,max:120},price:{min:1e4,max:1e5},onChange:w(p)},null,8,["onChange"])]),V(S)])}}}),Et=I(kt,[["__scopeId","data-v-53af5730"]]);export{Et as default};
