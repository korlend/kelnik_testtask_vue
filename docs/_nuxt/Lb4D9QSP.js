import{a as ce,J as I,r as h,K as xe,L as Se,H as Ce,M as de,N as De,E as A,O as re,P as Le,Q as Ne,R as y,d as B,S as q,T as K,j as X,t as L,v as P,U as me,x as i,V as fe,_ as U,o as ve,W as Ee,e as _e,z as V,A as R,X as H,Y as O,B as T,Z as Q,$ as Y,y as E,a0 as Pe,a1 as ke,a2 as Me,a3 as Ve,u as $e,a4 as Te}from"./BGacrcHs.js";const Oe=t=>t==="defer"||t===!1;function Re(...t){var w;const l=typeof t[t.length-1]=="string"?t.pop():void 0;typeof t[0]!="string"&&t.unshift(l);let[a,u,e={}]=t;if(typeof a!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof u!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");const n=ce(),v=u,d=()=>I.value,f=()=>n.isHydrating?n.payload.data[a]:n.static.data[a];e.server=e.server??!0,e.default=e.default??d,e.getCachedData=e.getCachedData??f,e.lazy=e.lazy??!1,e.immediate=e.immediate??!0,e.deep=e.deep??I.deep,e.dedupe=e.dedupe??"cancel";const p=e.getCachedData(a,n),s=p!=null;if(!n._asyncData[a]||!e.immediate){(w=n.payload._errors)[a]??(w[a]=I.errorValue);const x=e.deep?h:xe;n._asyncData[a]={data:x(s?p:e.default()),pending:h(!s),error:Se(n.payload._errors,a),status:h("idle"),_default:e.default}}const c={...n._asyncData[a]};delete c._default,c.refresh=c.execute=(x={})=>{if(n._asyncDataPromises[a]){if(Oe(x.dedupe??e.dedupe))return n._asyncDataPromises[a];n._asyncDataPromises[a].cancelled=!0}if(x._initial||n.isHydrating&&x._initial!==!1){const g=x._initial?p:e.getCachedData(a,n);if(g!=null)return Promise.resolve(g)}c.pending.value=!0,c.status.value="pending";const _=new Promise((g,S)=>{try{g(v(n))}catch($){S($)}}).then(async g=>{if(_.cancelled)return n._asyncDataPromises[a];let S=g;e.transform&&(S=await e.transform(g)),e.pick&&(S=Ae(S,e.pick)),n.payload.data[a]=S,c.data.value=S,c.error.value=I.errorValue,c.status.value="success"}).catch(g=>{if(_.cancelled)return n._asyncDataPromises[a];c.error.value=Ne(g),c.data.value=y(e.default()),c.status.value="error"}).finally(()=>{_.cancelled||(c.pending.value=!1,delete n._asyncDataPromises[a])});return n._asyncDataPromises[a]=_,n._asyncDataPromises[a]},c.clear=()=>Be(n,a);const m=()=>c.refresh({_initial:!0}),r=e.server!==!1&&n.payload.serverRendered;{const x=Ce();if(x&&r&&e.immediate&&!x.sp&&(x.sp=[]),x&&!x._nuxtOnBeforeMountCbs){x._nuxtOnBeforeMountCbs=[];const S=x._nuxtOnBeforeMountCbs;de(()=>{S.forEach($=>{$()}),S.splice(0,S.length)}),De(()=>S.splice(0,S.length))}r&&n.isHydrating&&(c.error.value||p!=null)?(c.pending.value=!1,c.status.value=c.error.value?"error":"success"):x&&(n.payload.serverRendered&&n.isHydrating||e.lazy)&&e.immediate?x._nuxtOnBeforeMountCbs.push(m):e.immediate&&m();const _=Le();if(e.watch){const S=A(e.watch,()=>c.refresh());_&&re(S)}const g=n.hook("app:data:refresh",async S=>{(!S||S.includes(a))&&await c.refresh()});_&&re(g)}const C=Promise.resolve(n._asyncDataPromises[a]).then(()=>c);return Object.assign(C,c),C}function Be(t,l){l in t.payload.data&&(t.payload.data[l]=void 0),l in t.payload._errors&&(t.payload._errors[l]=I.errorValue),t._asyncData[l]&&(t._asyncData[l].data.value=void 0,t._asyncData[l].error.value=I.errorValue,t._asyncData[l].pending.value=!1,t._asyncData[l].status.value="idle"),l in t._asyncDataPromises&&(t._asyncDataPromises[l]&&(t._asyncDataPromises[l].cancelled=!0),t._asyncDataPromises[l]=void 0)}function Ae(t,l){const a={};for(const u of l)a[u]=t[u];return a}var D=(t=>(t.ASC="asc",t.DESC="desc",t.NONE="none",t))(D||{});const Xe={class:"sort-switch__text"},Ue=B({__name:"SortSwitch",props:q({disabled:{type:Boolean,default:!1}},{modelValue:{type:String,default:D.NONE},modelModifiers:{}}),emits:q(["change"],["update:modelValue"]),setup(t,{emit:l}){const a=K(t,"modelValue"),u=l,e=t,n=X(()=>{const d=[];return e.disabled&&d.push("disabled"),a.value===D.ASC&&d.push("asc"),a.value===D.DESC&&d.push("desc"),d}),v=d=>{if(e.disabled){d.preventDefault(),d.stopPropagation();return}a.value===D.NONE?a.value=D.ASC:a.value===D.ASC?a.value=D.DESC:a.value=D.NONE,u("change",a.value)};return(d,f)=>(P(),L("div",{class:me(["sort-switch",y(n)]),onClick:v,onTouchend:v},[i("div",Xe,[fe(d.$slots,"default",{},void 0)]),f[0]||(f[0]=i("span",{class:"sort-switch__arrows"},[i("span",{class:"sort-switch__arrows-top-arrowhead"}),i("span",{class:"sort-switch__arrows-bottom-arrowhead"})],-1))],34))}}),Ie=U(Ue,[["__scopeId","data-v-b8166080"]]),ze=Symbol.for("nuxt:client-only"),je=B({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(t,{slots:l,attrs:a}){const u=h(!1);return ve(()=>{u.value=!0}),Ee(ze,!0),e=>{var f;if(u.value)return(f=l.default)==null?void 0:f.call(l);const n=l.fallback||l.placeholder;if(n)return n();const v=e.fallback||e.placeholder||"",d=e.fallbackTag||e.placeholderTag||"span";return L(d,a,v)}}});var M=(t=>(t.XS="xs",t.SM="sm",t.MD="md",t.SLG="slg",t.LG="lg",t.XL="xl",t.XXL="xxl",t))(M||{});class J{constructor(l,a=D.NONE){this.sortBy=l,this.sortDirection=a}}function Z(){const t=h({height:0,width:0}),l=h({x:0,y:0}),a={[M.XS]:0,[M.SM]:480,[M.MD]:720,[M.SLG]:960,[M.LG]:1200,[M.XL]:1440,[M.XXL]:1920};de(()=>{n(),window.addEventListener("resize",e),window.addEventListener("scroll",u)}),_e(()=>{window.removeEventListener("resize",e),window.removeEventListener("scroll",u)});const u=()=>{l.value={x:window.scrollX,y:window.scrollY}},e=()=>{n()},n=()=>{t.value.height=window.innerHeight,t.value.width=window.innerWidth},v=(f,p)=>{const s=Object.values(M),c=s.findIndex(C=>f===C),m=p?s.findIndex(C=>p===C):s.length;return s.slice(c,m+1).includes(d.value)},d=X(()=>{const f=Object.values(M);for(let p=f.length-1;p>=0;p--){const s=f[p];if(a[s]<=t.value.width)return s}return f[f.length-1]});return{currentResolution:d,windowSize:t,scrollPos:l,includeResolutions:v,resolutionsValues:a}}var Fe={};const qe={class:"apartments-list"},He={key:0,class:"apartments-list__blocks"},We={class:"apartments-list__blocks-sorting"},Ge={class:"apartments-list__blocks-item"},Ke={class:"apartments-list__blocks-item__data"},Qe={class:"apartments-list__blocks-item__data-name"},Ye={class:"apartments-list__blocks-item__data-other"},Je={class:"opacity-50"},Ze=["src"],et={key:1,class:"apartments-list__table"},tt={class:"apartments-list__table-head-row"},at={class:"apartments-list__table-data-row"},st=["src"],nt={class:"opacity-50"},lt=B({__name:"ListBlock",props:{apartments:{type:Array,default:[]}},emits:["sort-change"],setup(t,{emit:l}){const a=l,u=h(D.NONE),e=h(D.NONE),n=h(D.NONE),{includeResolutions:v}=Z(),d=(p,s)=>{switch(u.value=D.NONE,e.value=D.NONE,n.value=D.NONE,p){case"area":u.value=s;break;case"level":e.value=s;break;case"price":n.value=s;break}a("sort-change",new J(p,s))},f=p=>`${Fe.NUXT_APP_BASE_URL||""}${p.structure_image}`;return(p,s)=>{const c=Ie,m=je;return P(),L("div",qe,[V(m,null,{default:R(()=>[y(v)(y(M).XS,y(M).LG)?(P(),L("div",He,[i("div",We,[V(c,{modelValue:y(u),"onUpdate:modelValue":[s[0]||(s[0]=r=>O(u)?u.value=r:null),s[1]||(s[1]=r=>d("area",r))]},{default:R(()=>s[12]||(s[12]=[T("S, м²")])),_:1},8,["modelValue"]),V(c,{modelValue:y(e),"onUpdate:modelValue":[s[2]||(s[2]=r=>O(e)?e.value=r:null),s[3]||(s[3]=r=>d("level",r))]},{default:R(()=>s[13]||(s[13]=[T("Этаж")])),_:1},8,["modelValue"]),V(c,{modelValue:y(n),"onUpdate:modelValue":[s[4]||(s[4]=r=>O(n)?n.value=r:null),s[5]||(s[5]=r=>d("price",r))]},{default:R(()=>s[14]||(s[14]=[T("Цена, ₽")])),_:1},8,["modelValue"])]),(P(!0),L(Q,null,Y(t.apartments,r=>(P(),L("div",Ge,[i("div",Ke,[i("div",Qe,E(r.name),1),i("div",Ye,[i("span",null,E(r.area)+" м²",1),i("span",null,[T(E(r.level)+" ",1),i("span",Je," из "+E(r.level_total)+" этаж ",1)]),i("span",null,E(r.price)+" ₽",1)])]),i("img",{class:"apartments-list__blocks-item__image",src:f(r)},null,8,Ze)]))),256))])):H("",!0),y(v)(y(M).XL)?(P(),L("table",et,[i("thead",null,[i("tr",tt,[s[18]||(s[18]=i("th",null,"Планировка",-1)),s[19]||(s[19]=i("th",null,"Квартира",-1)),s[20]||(s[20]=i("th",null,"Комнат",-1)),i("th",null,[V(c,{modelValue:y(u),"onUpdate:modelValue":[s[6]||(s[6]=r=>O(u)?u.value=r:null),s[7]||(s[7]=r=>d("area",r))]},{default:R(()=>s[15]||(s[15]=[T("S, м²")])),_:1},8,["modelValue"])]),i("th",null,[V(c,{modelValue:y(e),"onUpdate:modelValue":[s[8]||(s[8]=r=>O(e)?e.value=r:null),s[9]||(s[9]=r=>d("level",r))]},{default:R(()=>s[16]||(s[16]=[T("Этаж")])),_:1},8,["modelValue"])]),i("th",null,[V(c,{modelValue:y(n),"onUpdate:modelValue":[s[10]||(s[10]=r=>O(n)?n.value=r:null),s[11]||(s[11]=r=>d("price",r))]},{default:R(()=>s[17]||(s[17]=[T("Цена, ₽")])),_:1},8,["modelValue"])])])]),i("tbody",null,[(P(!0),L(Q,null,Y(t.apartments,r=>(P(),L("tr",at,[i("td",null,[i("img",{class:"apartments-list__table-data-row__image",src:f(r)},null,8,st)]),i("td",null,E(r.name),1),i("td",null,E(r.rooms),1),i("td",null,E(r.area),1),i("td",null,[T(E(r.level)+" ",1),i("span",nt,"из "+E(r.level_total),1)]),i("td",null,E(r.price),1)]))),256))])])):H("",!0)]),_:1})])}}}),ot=U(lt,[["__scopeId","data-v-24281865"]]),rt={class:"circle-button__text"},it=B({__name:"CircleButton",props:{active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},setup(t){const l=t,a=X(()=>{const e=[];return l.active&&e.push("active"),l.disabled&&e.push("disabled"),e}),u=e=>{l.disabled&&(e.preventDefault(),e.stopPropagation())};return(e,n)=>(P(),L("div",{class:me(["circle-button",y(a)]),onClick:u,onTouchend:u},[i("div",rt,[fe(e.$slots,"default",{},void 0)])],34))}}),ut=U(it,[["__scopeId","data-v-4ef955f8"]]),ct={class:"number-slider__label"},dt={class:"number-slider__numbers"},mt={class:"number-slider__numbers-number"},ft={class:"number-slider__numbers-number"},vt={class:"number-slider__slider"},ie=0,_t=B({__name:"NumberSlider",props:q({label:{type:String,required:!0},min:{type:Number,required:!0},max:{type:Number,required:!0}},{left:{type:Number},leftModifiers:{},right:{type:Number},rightModifiers:{}}),emits:q(["change"],["update:left","update:right"]),setup(t,{emit:l}){const a=l,u=K(t,"left"),e=K(t,"right"),n=Pe("sliderRefName"),v=h(!1),d=h(0),f=h(0),p=h(0),s=h(0),c=h(!1),m=h(0),r=h(0),C=h(0),w=h(0),x=h(void 0),_=t,{windowSize:g}=Z();A(g.value,()=>{S(),W()}),A(()=>_.min,()=>{u.value=_.min}),A(()=>_.max,()=>{e.value=_.max}),A(u,(o,b)=>{o&&W()}),A(e,(o,b)=>{o&&W()}),ve(()=>{S(),u.value=_.min,e.value=_.max,m.value=$.value,G(d.value,m.value),window.addEventListener("touchend",j),window.addEventListener("mouseup",j),window.addEventListener("touchmove",z),window.addEventListener("mousemove",z)}),_e(()=>{window.removeEventListener("touchend",j),window.removeEventListener("mouseup",j),window.removeEventListener("touchmove",z),window.removeEventListener("mousemove",z)});const S=()=>{var o;x.value=(o=n==null?void 0:n.value)==null?void 0:o.getBoundingClientRect()},$=X(()=>{var o;return((o=x.value)==null?void 0:o.width)||0}),pe=X(()=>({"--left-shift":`${d.value}px`,"--right-shift":`${m.value}px`,"--active-background-width":`${m.value-d.value}px`})),W=()=>{const o=_.max-_.min;if(u.value){const N=(u.value-_.min)/o,k=Math.round(N*$.value);d.value=k}if(e.value){const N=(e.value-_.min)/o,k=Math.round(N*$.value);m.value=k}},G=(o,b)=>{const N=_.max-_.min,k=o/$.value,be=b/$.value,we=_.min+N*k,ye=_.min+N*be,le=Math.round(we),oe=Math.round(ye);(u.value!==le||e.value!==oe)&&(u.value=le,e.value=oe,a("change",{left:u.value,right:e.value}))},j=o=>{o?z(o):(v.value&&(s.value=d.value,ae()),c.value&&(w.value=m.value,ne())),v.value=!1,c.value=!1},z=o=>{var N,k;o.stopPropagation(),o.preventDefault();let b;o instanceof MouseEvent?b=o.x:o instanceof TouchEvent&&(b=(k=(N=o==null?void 0:o.touches)==null?void 0:N[0])==null?void 0:k.clientX),b!==void 0&&(v.value&&(p.value=b,ae()),c.value&&(C.value=b,ne()))},te=o=>{var N,k;o.stopPropagation(),o.preventDefault();let b=0;o instanceof MouseEvent?b=o.x:o instanceof TouchEvent&&(b=(k=(N=o==null?void 0:o.touches)==null?void 0:N[0])==null?void 0:k.clientX),s.value=d.value,f.value=b,v.value=!0},ae=()=>{he(s.value+p.value-f.value)},he=o=>{o<ie?u.value=_.min:o>m.value?u.value=e.value:o>$.value?u.value=_.max:G(o,m.value)},se=o=>{var N,k;o.stopPropagation(),o.preventDefault();let b=0;o instanceof MouseEvent?b=o.x:o instanceof TouchEvent&&(b=(k=(N=o==null?void 0:o.touches)==null?void 0:N[0])==null?void 0:k.clientX),w.value=m.value,r.value=b,c.value=!0},ne=()=>{ge(w.value+C.value-r.value)},ge=o=>{o<d.value?e.value=u.value:o<ie?e.value=_.min:o>$.value?e.value=_.max:G(d.value,o)};return(o,b)=>(P(),L("div",{class:"number-slider",ref:"sliderRefName",style:ke(y(pe))},[i("div",ct,E(t.label),1),i("div",dt,[i("div",null,[b[0]||(b[0]=i("span",{class:"number-slider__numbers-label"},"от",-1)),i("span",mt,E(u.value),1)]),i("div",null,[b[1]||(b[1]=i("span",{class:"number-slider__numbers-label"},"до",-1)),i("span",ft,E(e.value),1)])]),i("div",vt,[b[2]||(b[2]=i("div",{class:"number-slider__slider-inactive-background"},null,-1)),b[3]||(b[3]=i("div",{class:"number-slider__slider-active-background"},null,-1)),i("div",{class:"number-slider__slider-left-button",onTouchstart:te,onMousedown:te},null,32),i("div",{class:"number-slider__slider-right-button",onTouchstart:se,onMousedown:se},null,32)])],4))}}),pt=U(_t,[["__scopeId","data-v-3e8a6203"]]);class F{constructor(l=0,a=5){this.from=l,this.limit=a}}class ee{constructor(l,a,u,e,n=[]){this.minPrice=l,this.maxPrice=a,this.minArea=u,this.maxArea=e,this.roomsCounts=n}}const ht=Me("apartments",{state:()=>({apartments:[],total:0}),getters:{getApartments:t=>t.apartments,getTotal:t=>t.total},actions:{async loadApartments(t=new F,l=new J,a=new ee){var s;const{$api:u}=ce(),n=await u("/apartments.json",{});if(!n)return!1;let v=[];for(let c=0;c<n.length;c++){const m=n[c];a.minPrice!==void 0&&m.price<a.minPrice||a.maxPrice!==void 0&&m.price>a.maxPrice||a.minArea!==void 0&&m.area<a.minArea||a.maxArea!==void 0&&m.area>a.maxArea||(s=a.roomsCounts)!=null&&s.length&&!a.roomsCounts.includes(m.rooms)||v.push(m)}const d=v.length;if(l.sortBy&&l.sortDirection!==D.NONE){const{sortBy:c,sortDirection:m}=l;v.sort((r,C)=>r[c]<C[c]?m===D.ASC?-1:1:r[c]>C[c]?m===D.ASC?1:-1:0)}const f=t.from||0,p=t.limit||5;return v=v.slice(f,f+p),this.apartments=v,this.total=d,!0}}}),gt={class:"apartments-filters"},bt={class:"apartments-filters__rooms"},wt=4,yt=B({__name:"FiltersBlock",props:{price:{type:Object,required:!0},area:{type:Object,required:!0}},emits:["change"],setup(t,{emit:l}){const a=t,u=l,e=h(0),n=h(0),v=h(0),d=h(0),f=h(new Set),p=C=>{f.value.has(C)?f.value.delete(C):f.value.add(C),m()},s=()=>{m()},c=()=>{m()},m=()=>{u("change",new ee(e.value,n.value,v.value,d.value,[...f.value]))},r=()=>{e.value=a.price.min,n.value=a.price.max,v.value=a.area.min,d.value=a.area.max,f.value=new Set,m()};return(C,w)=>{const x=ut,_=pt;return P(),L("div",gt,[i("div",bt,[(P(),L(Q,null,Y(wt,g=>V(x,{active:y(f).has(g),onClick:()=>p(g),onTouchend:()=>p(g)},{default:R(()=>[T(E(g)+"к",1)]),_:2},1032,["active","onClick","onTouchend"])),64))]),V(_,{left:y(e),"onUpdate:left":w[0]||(w[0]=g=>O(e)?e.value=g:null),right:y(n),"onUpdate:right":w[1]||(w[1]=g=>O(n)?n.value=g:null),label:"Стоимость квартиры, ₽",min:t.price.min,max:t.price.max,onChange:s},null,8,["left","right","min","max"]),w[5]||(w[5]=i("div",null,null,-1)),V(_,{left:y(v),"onUpdate:left":w[2]||(w[2]=g=>O(v)?v.value=g:null),right:y(d),"onUpdate:right":w[3]||(w[3]=g=>O(d)?d.value=g:null),label:"Площадь, м²",min:t.area.min,max:t.area.max,onChange:c},null,8,["left","right","min","max"]),w[6]||(w[6]=i("div",null,null,-1)),i("div",{class:"apartments-filters__clear",onClick:r,onTouchend:r},w[4]||(w[4]=[T(" Сбросить параметры "),i("span",{class:"apartments-filters__clear-icon x-icon"},null,-1)]),32)])}}}),xt=U(yt,[["__scopeId","data-v-e49fe4fe"]]),St=B({__name:"ScrollTop",setup(t){const{scrollPos:l}=Z(),a=()=>{scroll({top:0,behavior:"smooth"})};return(u,e)=>y(l).y>0?(P(),L("div",{key:0,class:"scroll-top",onClick:a,onTouchend:a},e[0]||(e[0]=[i("div",{class:"scroll-top__arrow-head"},null,-1),i("div",{class:"scroll-top__arrow-shaft"},null,-1)]),32)):H("",!0)}}),Ct=U(St,[["__scopeId","data-v-0921841e"]]);function ue(t,l){let a;return(...u)=>{clearTimeout(a),a=setTimeout(()=>{t(...u)},l)}}const Dt={class:"apartments-page"},Lt={class:"apartments-page__content"},Nt={class:"apartments-page__content-main"},Et=5,Pt=20,kt=B({__name:"index",async setup(t){let l,a;const u=Ve();$e();const e=ht(),n=h(new F),v=h(new ee),d=h(new J),f=h(!0);A(u,()=>{p()}),[l,a]=Te(()=>Re(()=>e.loadApartments(),"$pqtWcjQkdb")),await l,a();const p=async()=>{f.value=!0,await e.loadApartments(n.value,d.value,v.value),f.value=!1},s=ue(w=>{v.value=w,n.value=new F(0,Et),p()},50),c=ue(w=>{d.value=w,p()},20),m=()=>{n.value=new F(0,n.value.limit+Pt),p()},r=X(()=>e.getApartments),C=X(()=>e.getTotal);return(w,x)=>{const _=ot,g=xt,S=Ct;return P(),L("div",Dt,[i("div",Lt,[i("div",Nt,[x[0]||(x[0]=i("h1",{class:"apartments-page__content-main__label"},"Квартиры",-1)),V(_,{apartments:y(r),onSortChange:y(c)},null,8,["apartments","onSortChange"]),y(r).length<y(C)?(P(),L("div",{key:0,class:"apartments-page__content-load-more",onClick:m,onTouchend:m}," Загрузить еще ",32)):H("",!0)]),V(g,{class:"apartments-page__content-filters",area:{min:15,max:120},price:{min:1e4,max:1e5},onChange:y(s)},null,8,["onChange"])]),V(S)])}}}),Vt=U(kt,[["__scopeId","data-v-ea8c7e2c"]]);export{Vt as default};
